<!-- Hero -->
<div class="hero" [style.background-image]="'url(' + picturebackground + ')'">
</div>

<!-- Start:: under hero -->
<div class="under-hero container">
  <!-- Start:: section -->
  <div class="section">
    <div class="row">
      <div class="col-xl-12 col-md-10 mx-auto">
        <div class="card">
          <div class="card-header pb-0">
            <!-- Start:: mat tabs -->
            <div class="mat-tabs" appTabs>
              <ul class="nav nav-tabs" id="add_music" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="music" data-bs-toggle="tab" data-bs-target="#music_pane" type="button"
                    role="tab" aria-controls="music_pane" aria-selected="true">
                    Modifier une chanson
                  </button>
                </li>
              </ul>
            </div>
            <!-- End:: mat tabs -->
          </div>

          <div class="card-body">
            <div class="tab-content" id="add_music_content">
              <div class="tab-pane fade show active" id="music_pane" role="tabpanel" aria-labelledby="music" tabindex="0">

                <form [formGroup]="musicForm" (ngSubmit)="modifyMusic()">

                  <div class="col-12 mb-4" [hidden]="!musicForm.get('category')?.value">
                    <label class="form-label">Titre de la chanson</label>
                    <input type="text" formControlName="title" class="form-control" placeholder="Titre de la chanson">
                  </div>

                  <div class="col-sm-12 mb-4">
                    <label class="form-label">Dans quelle catégorie ?</label>
                    <select class="form-select" formControlName="category" aria-label="Select category">
                      <option value="" disabled hidden>Merci de choisir</option>
                      <option *ngFor="let c of categories" [value]="c.value">{{ c.label }}</option>
                    </select>
                  </div>

                  <div [hidden]="!musicForm.get('category')?.value">

                    <div class="col-sm-12 mb-4">
                      <label class="form-label">Votre chanson est une exclusivité</label>
                      <select class="form-select" formControlName="exclu" aria-label="Select exclusivité">
                        <option value="non">Non</option>
                        <option value="oui">Oui</option>
                      </select>
                    </div>

                    <div class="col-sm-12 mb-4">
                      <label class="form-label">Publier dans coup de coeur</label>
                      <select class="form-select" formControlName="isHeartStroke" aria-label="Select coup de coeur">
                        <option value="non">Non</option>
                        <option value="oui">Oui</option>
                      </select>
                    </div>

                    <div class="col-sm-12 mb-4">
                      <label class="form-label">Artiste</label>
                      <input type="text" class="form-control" formControlName="artist" placeholder="Artiste">
                    </div>

                    <div class="col-sm-12 mb-4" [hidden]="musicForm.get('exclu')?.value === 'oui'">
                      <label class="form-label">
                        Youtube (ex: https://www.youtube.com/watch?v=Aq1NJxJZo6E -> Mettre uniquement 'Aq1NJxJZo6E' ici)
                      </label>
                      <input type="text" class="form-control" formControlName="youtubeURL" placeholder="Youtube ID">
                    </div>

                    <div class="col-sm-12 mb-4">
                      <button type="button" (click)="openModal()" class="btn btn-custom w-10"
                        style="margin-bottom: 20px; margin-right: 10px;">
                        Aide
                      </button>
                      <label class="form-label">
                        Spotify (Click droit sur le titre Spotify -> Partager -> Intégrer le titre -> Choisir taille compacte ->
                        <span style="color: red">Copier url dans SRC="" (uniquement)</span> -> Coller sur creatoke)
                      </label>
                      <input type="text" class="form-control" formControlName="spotifyURL" placeholder="Spotify embed URL">
                    </div>

                    <div class="col-12 mb-4">
                      <label class="form-label">Description</label>
                      <textarea formControlName="description" cols="30" rows="4" class="form-control" placeholder="Description"></textarea>
                    </div>

                    <!-- CKEditor (keep in DOM, use [hidden] to avoid CKEditor duplicate globals) -->
                    <div class="col-12 mb-4" [hidden]="!showLyrics">
                      <label class="form-label">Lyrics</label>
                      <ck-editor
                        [config]="{ versionCheck: false }"
                        formControlName="lyrics"
                        skin="moono-lisa"
                        language="fr"
                        [fullPage]="false">
                      </ck-editor>
                    </div>

                    <div class="col-12 mb-4" [hidden]="!showMessage">
                      <label class="form-label">Message</label>
                      <ck-editor
                        [config]="{ versionCheck: false }"
                        formControlName="message"
                        skin="moono-lisa"
                        language="fr"
                        [fullPage]="false">
                      </ck-editor>
                    </div>

                    <div [hidden]="!showSongPrices">
                      <hr>
                      <h5>Prix Chanson</h5>
                      <hr>

                      <div class="col-sm-12 mb-4">
                        <label class="form-label">Afficher licence de base - <span style="color: green">chanson</span></label>
                        <select class="form-select" formControlName="isLicenceBase" aria-label="Select licence base">
                          <option value="non">Non</option>
                          <option value="oui">Oui</option>
                        </select>
                      </div>

                      <div class="col-sm-12 mb-4" [hidden]="musicForm.get('isLicenceBase')?.value === 'non'">
                        <label class="form-label">Prix licence de base (0 si gratuit)</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="ri-money-euro-circle-line"></i></span>
                          <input type="number" formControlName="price_base" class="form-control" placeholder="Prix licence basique - chanson">
                        </div>
                      </div>

                      <div class="col-sm-12 mb-4">
                        <label class="form-label">Afficher licence premium - <span style="color: green">chanson</span></label>
                        <select class="form-select" formControlName="isPremium" aria-label="Select licence premium">
                          <option value="non">Non</option>
                          <option value="oui">Oui</option>
                        </select>
                      </div>

                      <div class="col-sm-12 mb-4" [hidden]="musicForm.get('isPremium')?.value === 'non'">
                        <label class="form-label">Prix licence premium</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="ri-money-euro-circle-line"></i></span>
                          <input type="number" formControlName="price_premium" class="form-control" placeholder="Prix licence premium - chanson">
                        </div>
                      </div>
                    </div>

                    <div [hidden]="!showCreatokePrices">
                      <hr>
                      <h5>Prix créatoké</h5>
                      <hr>

                      <div class="col-sm-12 mb-4">
                        <label class="form-label">Afficher licence de base <span style="color: red">créatoké</span></label>
                        <select class="form-select" formControlName="isLicenceBaseCreatoke" aria-label="Select licence base">
                          <option value="non">Non</option>
                          <option value="oui">Oui</option>
                        </select>
                      </div>

                      <div class="col-sm-12 mb-4" [hidden]="musicForm.get('isLicenceBaseCreatoke')?.value === 'non'">
                        <label class="form-label">Prix licence de base (0 si gratuit)</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="ri-money-euro-circle-line"></i></span>
                          <input type="number" formControlName="price_base_creatoke" class="form-control" placeholder="Prix licence basique - créatoké">
                        </div>
                      </div>

                      <div class="col-sm-12 mb-4">
                        <label class="form-label">Afficher licence premium - <span style="color: red">créatoké</span></label>
                        <select class="form-select" formControlName="isPremiumCreatoke" aria-label="Select licence premium">
                          <option value="non">Non</option>
                          <option value="oui">Oui</option>
                        </select>
                      </div>

                      <div class="col-sm-12 mb-4" [hidden]="musicForm.get('isPremiumCreatoke')?.value === 'non'">
                        <label class="form-label">Prix licence premium (0 si gratuit)</label>
                        <div class="input-group">
                          <span class="input-group-text"><i class="ri-money-euro-circle-line"></i></span>
                          <input type="number" formControlName="price_premium_creatoke" class="form-control" placeholder="Prix licence premium créatoké">
                        </div>
                      </div>
                    </div>

                  </div>

                  <div class="col-sm-12 mb-4">
                    <button class="btn btn-primary" style="min-width: 140px;" type="submit" [disabled]="!musicForm.valid">
                      Enregistrer
                    </button>
                    <a href="/" class="btn btn-outline-secondary ms-2">Annuler</a>
                  </div>
                </form>

                <hr>
                <h5>Player de la chanson</h5>
                <hr>

                <ng-container *ngFor="let block of playerBlocks; trackBy: trackByBlock">
                  <div class="col-sm-12 mb-4" *ngIf="showBlock(block)">
                    <p>{{ block.label }}</p>

                    <button class="btn btn-primary"
                      *ngIf="block.play && hasMediaUrl(block.key)"
                      (click)="playSong(block.key, getMediaUrl(block.key))">
                      <span *ngIf="!playingMap[block.key]">▶️ Play</span>
                      <span *ngIf="playingMap[block.key]">Lecture</span>
                    </button>

                    <button class="btn btn-danger"
                      *ngIf="hasMediaUrl(block.key)"
                      (click)="stopSong(block.key)">
                      Stop
                    </button>

                    <input
                      type="file"
                      class="form-control"
                      [id]="'song_file_' + block.key"
                      [attr.accept]="block.accept"
                      (change)="onFileSelected($event, block.key)">

                    <div class="progress" *ngIf="progress[block.key] !== undefined">
                      <div
                        class="progress-bar"
                        role="progressbar"
                        [style.width.%]="progress[block.key]"
                        [attr.aria-valuenow]="progress[block.key]"
                        aria-valuemin="0"
                        aria-valuemax="100">
                        {{ progress[block.key] }}%
                      </div>
                    </div>

                    <p class="text-info">{{ getOriginalFilenameFromFirebaseUrl(getMediaUrl(block.key)) }}</p>
                  </div>
                </ng-container>

              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
  <!-- End:: section -->
</div>
<!-- End:: under hero -->

<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{ 'display': display }">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content custom">
      <div class="modal-header">
        <h4 class="modal-title text-center w-100">Aide</h4>
        <button type="button" class="close" aria-label="Close" (click)="onCloseHandled()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-sm-6 offset-sm-3">
          <p>Récupérer tout ce qui a entre src=" ... " sans les guillemets</p>
          <img src="./assets/images/spotify.png" alt="Image" style="width:500px;">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-custom" (click)="onCloseHandled()">Fermer</button>
      </div>
    </div>
  </div>
</div>